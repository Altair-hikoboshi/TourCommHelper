<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TourMate</title>
  <link rel="icon" type="image/png" href="assets/logo-icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    /* Reset & base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body, html {
      height: 100%;
      font-family: 'Poppins', sans-serif;
      background: #f0f2f5;
    }
    .container {
      display: flex;
      height: 100vh;
      width: 100%;
      position: relative;
    }
    .left, .right {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }
    .left {
      flex-direction: column;
      background: linear-gradient(135deg, #dfe9f3, #f7f9fc);
      color: #333;
      position: relative;
    }
    .logo {
      width: 200px;
      height: 200px;
      transition: transform 0.3s ease;
    }
    .logo:hover {
      transform: scale(1.1);
    }
    .app-name {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: #2c3e50;
    }
    .description {
      font-size: 0.9rem;
      font-weight: 300;
      text-align: justify;
      max-width: 400px;
      margin-bottom: 30px;
    }
    .closing {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: #2c3e50;
      text-align: center;
    }
    .language-switch {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 20;
      flex-wrap: nowrap;
      align-items: center;
      width: 320px;
    }
    .language-switch button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
    }
    .language-switch img {
      width: 44px;
      height: 44px;
      object-fit: cover;
      border-radius: 50%;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .language-switch button:hover img {
      transform: scale(1.2);
    }

    /* Search input container */
    #searchContainer {
      position: relative;
      flex-grow: 1;
      margin-left: 15px;
    }

    #searchInput {
      width: 100%;
      padding: 10px 40px 10px 15px;
      font-size: 16px;
      border-radius: 25px;
      border: 1.8px solid #3498db;
      box-shadow: 0 2px 6px rgba(52, 152, 219, 0.3);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      outline-offset: 2px;
      outline-color: transparent;
    }
    #searchInput:focus {
      border-color: #2980b9;
      box-shadow: 0 4px 12px rgba(41, 128, 185, 0.5);
      outline-color: #2980b9;
    }
    #searchInput::placeholder {
    font-size: 12px; /* or try 12px */
    }


    /* Clear (×) button inside search input */
    #clearBtn {
      position: absolute;
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      background: #ccc;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
      font-weight: bold;
      color: #555;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 25;
    }
    #clearBtn.visible {
      opacity: 1;
      pointer-events: auto;
    }
    #clearBtn:hover {
      background: #e74c3c;
      color: white;
    }

    /* Search results box */
    #searchResults {
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      width: 100%;
      max-height: 280px;
      overflow-y: auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      padding: 10px 0;
      font-size: 14px;
      color: #2c3e50;
      z-index: 20;
      transition: max-height 0.25s ease;
      display: none;
    }
    #searchResults p {
      margin: 0;
      padding: 8px 20px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    #searchResults p:hover,
    #searchResults p.active {
      background-color: #3498db;
      color: white;
    }
    #searchResults p a {
      text-decoration: none;
      color: inherit;
      display: block;
      width: 100%;
      height: 100%;
    }
    #searchResults p a:hover {
      color: inherit;
    }

    .right {
      background: url("assets/bgimage/bgimage.png") no-repeat center center/cover;
      position: relative;
    }
    .right::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1;
    }
    .buttons {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .buttons a {
      padding: 15px 30px;
      text-decoration: none;
      font-size: 1.2rem;
      color: #fff;
      background: #3498db;
      border: none;
      border-radius: 8px;
      text-align: center;
      transition: background 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .buttons a:hover {
      background: #2980b9;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .left, .right {
        flex: none;
        width: 100%;
        height: 50%;
      }
      .app-name {
        font-size: 2rem;
      }
      .buttons a {
        font-size: 1rem;
      }
      .buttons {
        align-items: center;
      }
      .language-switch {
        top: 10px;
        right: 10px;
        width: 100%;
        justify-content: center;
      }
      #searchContainer {
        margin-left: 10px;
      }
    }
    @media (max-width: 480px) {
      .description {
        font-size: 0.85rem;
        max-height: 150px;
        overflow-y: auto;
      }
      .closing {
        font-size: 0.9rem;
      }
      .app-name {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Language Switch + Search -->
    <div class="language-switch">
      <div id="searchContainer">
        <input type="text" id="searchInput" placeholder="Type keywords or categories..." autocomplete="off" aria-label="Search expressions" />
        <div id="clearBtn" role="button" aria-label="Clear search input" title="Clear">&times;</div>
        <div id="searchResults" role="listbox" aria-live="polite"></div>
      </div>
      <button onclick="switchLanguage('id')" aria-label="Bahasa Indonesia">
        <img src="assets/flags/id.png" alt="Bendera Indonesia" title="Bahasa Indonesia" />
      </button>
      <button onclick="switchLanguage('en')" aria-label="English">
        <img src="assets/flags/us.png" alt="US Flag" title="English" />
      </button>

    </div>

    <!-- Left side: Logo + Name + Description -->
    <div class="left">
      <img src="assets/logo/logo.png" alt="App Logo" class="logo" onerror="this.style.display='none';" />
      <div class="app-name" id="app-name">TourMate</div>
      <p class="description" id="description">
        TourMate adalah aplikasi praktis dan ramah pengguna yang dirancang khusus untuk membantu pemandu wisata dan wisatawan berkomunikasi dengan lebih mudah di berbagai situasi perjalanan. Aplikasi ini menyajikan ratusan ekspresi penting dalam Bahasa Indonesia dan Bahasa Inggris, dikelompokkan ke dalam 9 kategori wisata, mulai dari sambutan, tanya arah, belanja, hingga situasi darurat.
        Dengan TourMate, Anda tidak perlu bingung mencari kata-kata yang tepat saat menemani turis mancanegara atau menjelajahi tempat baru di Indonesia. Cukup buka aplikasi, pilih kategori, dan temukan ekspresi yang Anda butuhkan — cepat, tepat, dan sesuai konteks!
      </p>
      <p class="closing" id="closing">
        TourMate, sahabat terbaik Anda dalam menjembatani bahasa dan budaya saat berwisata!
      </p>
    </div>

    <!-- Right side: Buttons -->
    <div class="right">
      <div class="buttons">
        <a href="tourist.html" aria-label="Tourist mode">Saya adalah Turis</a>
        <a href="tour-guide.html" aria-label="Tour Guide mode">Saya adalah Tour Guide</a>
      </div>
    </div>
  </div>

  <meta name="description" content="TourMate membantu wisatawan dan pemandu wisata berkomunikasi dengan ekspresi penting dalam Bahasa Indonesia & Inggris.">

  <script>
    let touristData = {};
    let tourGuideData = {};

    async function loadData() {
      try {
        const resTourist = await fetch('tourist.json');
        touristData = await resTourist.json();

        const resTourGuide = await fetch('tour-guide.json');
        tourGuideData = await resTourGuide.json();

        console.log('Data loaded', touristData, tourGuideData);
      } catch (e) {
        console.error('Failed to load JSON files:', e);
      }
    }

    // Search function based on current language and query
    function searchExpressions(query, lang) {
      const results = [];

      function searchInData(data, pageName) {
        for (const category in data) {
          const expressions = data[category];
          expressions.forEach(([eng, ind], index) => {
            const phraseToSearch = lang === 'id' ? ind.toLowerCase() : eng.toLowerCase();
            const otherPhrase = lang === 'id' ? eng.toLowerCase() : ind.toLowerCase();

            if (
              phraseToSearch.includes(query) ||
              category.toLowerCase().includes(query) ||
              otherPhrase.includes(query)
            ) {
              results.push({ page: pageName, category, eng, ind, index });
            }
          });
        }
      }

      searchInData(touristData, 'tourist.html');
      searchInData(tourGuideData, 'tour-guide.html');

      // Sort results to prioritize matches in current language
      results.sort((a, b) => {
        const aMatchLang = lang === 'id' ? a.ind.toLowerCase().includes(query) : a.eng.toLowerCase().includes(query);
        const bMatchLang = lang === 'id' ? b.ind.toLowerCase().includes(query) : b.eng.toLowerCase().includes(query);
        return (bMatchLang === aMatchLang) ? 0 : bMatchLang ? 1 : -1;
      });

      return results;
    }

    // Elements
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const clearBtn = document.getElementById('clearBtn');

    function renderResults(matches, lang) {
  if (matches.length === 0) {
    searchResults.innerHTML = '<p>No results found.</p>';
    searchResults.style.display = 'block';
    return;
  }
  searchResults.innerHTML = matches
    .map(({ page, category, eng, ind, index }, i) => {
      const url = `${page}?category=${encodeURIComponent(category)}&index=${index}`;
      const displayText = lang === 'id' ? ind : eng;
      return `<p role="option" tabindex="-1" data-index="${i}" data-url="${url}">
                <a href="${url}">${displayText} <small style="color:gray">(${category})</small></a>
              </p>`;
    })
    .join('');
  searchResults.style.display = 'block';
}
    // Clear search input
    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      searchResults.style.display = 'none';
      clearBtn.classList.remove('visible');
      searchInput.focus();
    });

    // Handle input event
   searchInput.addEventListener('input', (e) => {
  const query = e.target.value.trim().toLowerCase();
  clearBtn.classList.toggle('visible', query.length > 0);

  if (!query) {
    searchResults.innerHTML = '';
    searchResults.style.display = 'none';
    return;
    searchResults.style.display = 'block'; // Show panel if there are matches
  }
  const lang = currentLanguage;
  const results = searchExpressions(query, lang);
  renderResults(results, lang);
  selectedResultIndex = -1;
});
    // Keyboard navigation of results
    let selectedResultIndex = -1;

    searchInput.addEventListener('keydown', (e) => {
      const resultsItems = searchResults.querySelectorAll('p');
      if (!resultsItems.length) return;

      if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (selectedResultIndex < resultsItems.length - 1) {
          selectedResultIndex++;
          updateActiveResult();
        }
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (selectedResultIndex > 0) {
          selectedResultIndex--;
          updateActiveResult();
        }
      } else if (e.key === 'Enter') {
        if (selectedResultIndex >= 0 && selectedResultIndex < resultsItems.length) {
          e.preventDefault();
          const url = resultsItems[selectedResultIndex].dataset.url;
          if (url) {
            window.location.href = url;
          }
        }
      }
    });

    function updateActiveResult() {
      const resultsItems = searchResults.querySelectorAll('p');
      resultsItems.forEach((item, idx) => {
        if (idx === selectedResultIndex) {
          item.classList.add('active');
          item.scrollIntoView({ block: 'nearest' });
          item.setAttribute('aria-selected', 'true');
          searchInput.setAttribute('aria-activedescendant', 'search-result-' + idx);
          item.id = 'search-result-' + idx;
        } else {
          item.classList.remove('active');
          item.setAttribute('aria-selected', 'false');
          item.id = '';
        }
      });
    }

    // Language switching logic
    let currentLanguage = 'id';
    function switchLanguage(lang) {
      currentLanguage = lang;
      // Update placeholder for accessibility
      if (lang === 'id') {
        searchInput.placeholder = 'Ketik kata kunci atau kategori...';
        document.getElementById('app-name').textContent = 'TourMate';
        document.getElementById('description').textContent =
          'TourMate adalah aplikasi praktis dan ramah pengguna yang dirancang khusus untuk membantu pemandu wisata dan wisatawan berkomunikasi dengan lebih mudah di berbagai situasi perjalanan. Aplikasi ini menyajikan ratusan ekspresi penting dalam Bahasa Indonesia dan Bahasa Inggris, dikelompokkan ke dalam 9 kategori wisata, mulai dari sambutan, tanya arah, belanja, hingga situasi darurat. Dengan TourMate, Anda tidak perlu bingung mencari kata-kata yang tepat saat menemani turis mancanegara atau menjelajahi tempat baru di Indonesia. Cukup buka aplikasi, pilih kategori, dan temukan ekspresi yang Anda butuhkan — cepat, tepat, dan sesuai konteks!';
        document.getElementById('closing').textContent = 'TourMate, sahabat terbaik Anda dalam menjembatani bahasa dan budaya saat berwisata!';
      } else {
        searchInput.placeholder = 'Type keywords or categories...';
        document.getElementById('app-name').textContent = 'TourMate';
        document.getElementById('description').textContent =
          'TourMate is a practical and user-friendly app designed specifically to help tour guides and tourists communicate more easily in various travel situations. The app presents hundreds of essential expressions in Indonesian and English, grouped into 9 travel categories, from greetings, asking directions, shopping, to emergency situations. With TourMate, you don’t need to struggle finding the right words when accompanying international tourists or exploring new places in Indonesia. Just open the app, choose a category, and find the expressions you need — fast, accurate, and context-appropriate!';
        document.getElementById('closing').textContent = 'TourMate, your best friend in bridging language and culture while traveling!';
      }
      searchInput.value = '';
      searchResults.innerHTML = '';
      clearBtn.classList.remove('visible');
      searchInput.focus();
    }

    // Initialize data and UI on load
    window.addEventListener('load', () => {
      loadData();
      switchLanguage(currentLanguage);
    });
  </script>
</body>
</html>
